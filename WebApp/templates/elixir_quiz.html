<!DOCTYPE html>
<html>
<head>
    <title>Elixir Values Trainer</title>
</head>
<body>

<div style="width: 100vw; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center;">

    <h1>Elixir Values Trainer</h1>

    <div id="game-box" style="border: 1px solid black; padding: 40px 20px 40px 20px; width: 300px; display: flex; flex-direction: column; align-items: center;">

        <p style="font-size: 14px; margin: 0px;">How much elixir does this card cost:</p>
        <p id="card-name" style="font-size: 40px; margin: 6px 0px 20px 0px; text-align: center;">Loading...</p>
        <img id="card-image" style="width: 120px; height: auto; margin-bottom: 26px; margin-top: -18px;" />
        <div id="input" style="display: flex; justify-content: center; width: 400px;">
            <input type="number" id="guess" min="1" max="9" style="width: 60px;">
            <button id="submit-btn" style="margin-left: 10px;">Submit Guess</button>
        </div>
        <button id="new-game-btn" style="margin-top: 0; display: none">New Round</button>

    </div>

    <p id="message" style="margin-top: 30px; font-size: 18px;"></p>

    <a href="/" style="text-decoration: none; color: black;">
        <button>Home</a>
    </a>
</div>

<script>
console.log("Elixir Quiz Loaded");
async function fetchNextCard() {
    const res = await fetch("/api/next_card");
    const data = await res.json();

    document.getElementById("card-name").innerText = data.card;

    const img = document.getElementById("card-image");
    if (data.image) {
        img.src = data.image;
        img.style.display = "block";
    } else {
        img.style.display = "none";  // hide if no image
    }
}

async function submitGuess() {
    const guess = document.getElementById("guess").value;

    const res = await fetch("/api/submit_guess", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ guess: guess })
    });

    const data = await res.json();

    if (data.correct) {
        document.getElementById("message").innerText = `${data.correct_elixir} is correct!`;
    } else {
        document.getElementById("message").innerHTML =
            `${data.user_guess} elixir is wrong! ${data.card} costs ${data.correct_elixir} elixir.`;
    }

    document.getElementById("guess").value = "";

    if (data.finished) {
        const plural = data.incorrect_guesses === 1 ? "" : "es";
        document.getElementById("card-name").innerText = `All cards completed! You had ${data.incorrect_guesses} wrong guess${plural}.`;
        document.getElementById("submit-btn").disabled = true;
        document.getElementById("input").style.display = "none";
        document.getElementById("new-game-btn").style.display = "block";
        document.getElementById("card-image").style.display = "none";
    } else {
        fetchNextCard();
    }
}

async function newGame() {
    location.reload();  // reload the page to start new game
}

document.getElementById("submit-btn").onclick = submitGuess;
document.getElementById("new-game-btn").onclick = newGame;

// Enable Enter key to submit guess
document.getElementById("guess").addEventListener("keydown", function(event) {
    if (event.key === "Enter") {
        event.preventDefault();
        submitGuess();
    }
});

// Load first card
fetchNextCard();
</script>

</body>
</html>
